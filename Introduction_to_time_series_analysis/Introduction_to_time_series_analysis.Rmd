---
title: "Introduction to Time Series Analysis"
author: "Jeff Li"
date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: true
    toc_depth: 3
    toc_float: true
---

"I maintained my edge by always being a student; you will always have something new to learn". - Jackie Joyner Kersee


**Course Description**

"Many phenomena in our day-to-day lives, such as the movement of stock prices, are measured in intervals over a period of time. Time series analysis methods are extremely useful for analyzing these special data types. In this course, you will be introduced to some core time series analysis concepts and techniques."

Ref: matteson, David (2018) Introduction to Time Series Analysis, https://www.datacamp.com/courses/introduction-to-time-series-analysis, 2018.


Note: Some course materials and data have beem revised for training by Jeff Li. 

# (I) Load required libraries
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

```


# 1. Exploratory time series data analysis

"This chapter will give you insights on how to organize and visualize time series data in R. You will learn several simplifying assumptions that are widely used in time series analysis, and common characteristics of financial time series."

## 1.1 Exloring raw time series

River Nile annual streamflow data. 

```{r, eval=FALSE}
# create the data
 streamflow <- c(1120, 1160,  963, 1210, 1160, 1160,  813, 1230, 1370, 1140,  995,  935, 1110,  994, 1020,
                  960, 1180,  799,  958, 1140, 1100, 1210, 1150, 1250, 1260, 1220, 1030, 1100,  774,  840,
                  874,  694,  940,  833,  701,  916,  692, 1020, 1050,  969,  831,  726,  456,  824,  702,
                 1120, 1100,  832,  764,  821,  768,  845,  864,  862,  698,  845,  744,  796, 1040,  759,
                  781,  865,  845,  944,  984,  897,  822, 1010,  771,  676,  649,  846,  812,  742,  801,
                 1040,  860,  874,  848,  890,  744,  749,  838, 1050,  918,  986,  797,  923,  975,  815,
                 1020,  906,  901, 1170,  912,  746,  919,  718,  714,  740)

Nile <- ts(streamflow, frequency = 1, start = 1871, end = 1970)

# print the Nile dataset
print(Nile)

# List the number of observation in the Nile dataset
length(Nile)

# Display the first 10 elelments of the Nile dataset
head(Nile, n = 10)

# Display the last 12 elements of the Nile dataset
tail(Nile, n = 12)
```

## 1.2 Basic time series plots

```{r}
# Plot the Nile data
plot(Nile)

# Plot the Nile data with xlab adn ylab arguments
plot(Nile, xlab = "Year", ylab = "River Volume (1e9 m^{3}")

# Plot the Nile data with xlab, ylab, main, and type arguments
plot(Nile, xlab = "Year", ylab = "River Volume (1e9 m^{3}", main = "Annual River Nile Volume at Aswan, 1871 - 1970", type = "b")
```

## 1.3 Continuous and discrete time index 

```{r, eval=FALSE}
# Plot the continuous_series using continuous time indexing
par(mfrow=c(2,1))
plot(continuous_time_index,continuous_series, type = "b")

# Make a discrete time index using 1:20 
discrete_time_index <- 1:20

# Now plot the continuous_series using discrete time indexing
plot(discrete_time_index,continuous_series, type = "b")

```

## 1.4 Sampling Frequency

* Exact 

* Approximate

* Missing

R Functions: start(), end(), frequency(), deltat(). There functions can provide considerable descriptive information about the structures and patterns in the time series data. 

```{r, eval=FALSE}
# Plot AirPassengers
plot(AirPassengers)

# View the start and end dates of AirPassengers
start(AirPassengers)
end(AirPassengers)


# Use time(), deltat(), frequency(), and cycle() with AirPassengers 
time(AirPassengers)
deltat(AirPassengers)
frequency(AirPassengers)
cycle(AirPassengers)

```

## 1.5 Missing values

Normally, a simple data imputation using the mean is not a great method to approximate what's really going on in the real situation. 

```{r, eval=FALSE}
# Plot the AirPassengers data
plot(AirPassengers)

# Compute the mean of AirPassengers
mean(AirPassengers, na.rm = TRUE)

# Impute mean values to NA in AirPassengers
AirPassengers[85:96] <- mean(AirPassengers, na.rm = TRUE)

# Generate another plot of AirPassengers
plot(AirPassengers)

# Add the complete AirPassengers data to your plot
rm(AirPassengers)
points(AirPassengers, type = "l", col = 2, lty = 3)

```

## 1.6 Basic Time Series Objects

```{r}
# building ts() objects
data_vector <- c(10, 6, 11, 8, 10, 3, 6, 9)

time_series <- ts(data_vector)
plot(time_series)

# specifiy the start date and observation frequency
time_series <- ts(data_vector, start = 2001, frequency = 1)
plot(time_series)

# check whether an object is of the ts() class: 
is.ts(data_vector)
is.ts(time_series)
```

A time series object is a vector (univariate) or matrix with addition attributes: time indices, sampling frequency, time increment, the cycle length. 

```{r, eval=FALSE}
# Use print() and plot() to view data_vector
print(data_vector)
plot(data_vector)

# Convert data_vector to a ts object with start = 2004 and frequency = 4
time_series <- ts(data_vector, start = 2004, frequency = 4)

# Use print() and plot() to view time_series
print(time_series)
plot(time_series)
  
```

## 1.7 Plotting a time series object
```{r}
# Check whether eu_stocks is a ts object
eu_stocks <- EuStockMarkets
is.ts(eu_stocks)

# View the start, end, and frequency of eu_stocks
start(eu_stocks)
end(eu_stocks)
frequency(eu_stocks)

# Generate a simple plot of eu_stocks
plot(eu_stocks)

# Use ts.plot with eu_stocks
ts.plot(eu_stocks, col = 1:4, xlab = "Year", ylab = "Index Value", main = "Major European Stock Indices, 1991-1998")

# Add a legend to your ts.plot
legend("topleft", colnames(eu_stocks), lty = 1, col = 1:4, bty = "n")
```


# 2. Predicting the future

## 2.1 Trend Spotting

* Linear     (diff() can remove a linear trend)

* Rapid growth    (log transformation can linearize a rapid growth trend)

* Periodic

* Variance: increase variance trends over time


## 2.2 Removing trends in level by differencing

The first difference transformation of a time series z[t] consists of the differences (changes) between successive observations over time, that is z[t]−z[t−1].

Differencing a time series can remove a time trend. The function diff() will calculate the first difference or change series. A difference series lets you examine the increments or changes in a given time series. It always has one fewer observations than the original series.

```{r, eval=FALSE}
# Generate the first difference of z
dz <- diff(z)
  
# Plot dz
ts.plot(dz)

# View the length of z and dz, respectively
length(z)
length(dz)
```
By removing the long-term time trend, we can view the amount of change from one observation to the next. 


## 2.3 Removing seasonal trends with seasonal differencing
```{r, eval=FALSE}
# Generate a diff of x with lag = 4. Save this to dx
dx <- diff(x, lag = 4)
  
# Plot dx
  ts.plot(dx)

# View the length of x and dx, respectively 
length(x)
length(dx)


```

