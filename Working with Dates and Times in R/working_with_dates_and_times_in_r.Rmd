---
title: "Working with Dates and Times in R "
author: "Jeff Li"
date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: true
    toc_depth: 3
    toc_float: true
---

"I maintained my edge by always being a student; you will always have something new to learn". - Jackie Joyner Kersee


Ref: Wickham, C. Working with Dates and Times in R, www.datacamp.com, 2018.

Charloote Wickham, an assistant Professor at Oregon State University, is passionate about teaching. I want to learn here teaching style. 


# (i) Course Description

This course covers the essentials of parsing, manipulating, and computing with dates and times in R. 



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# (ii) Load Required Libraries
```{r, message = FALSE}
library(lubridate)
library(anytime)
library(tidyverse)
```


# 1. Dates and Times in R

Objective: 

* Learn the ways that R stores data and times


The global standard numeric date format: ISO 8601 YYYY-MM-DD (for example 1982-07-12, it is my friend's birthday!). 

* ordered from the largest to smallest unit of time

* has a fixed number of digits


## 1.1 **Date** objects are stored as days since 1970-01-01. 


```{r}
#-------------------------------------- 
# The date R 3.0.0 was released
x <- "2013-04-03"

# Examine structure of x
str(x)

# Use as.Date() to interpret x as a date
x_date <- as.Date(x)

# Examine structure of x_date
str(x_date)

# Store April 10 2014 as a Date
april_10_2014 <- as.Date("2014-04-10")
class(april_10_2014)


#-------------import with readr and anytime packages---------------
# Use read_csv() to import rversions.csv
releases <- read_csv("data/rversions.csv")

# Examine the structure of the date column
str(releases$date)

# Various ways of writing Sep 10 2009
sep_10_2009 <- c("September 10 2009", "2009-09-10", "10 Sep 2009", "09-10-2009")

# Use anytime() to parse sep_10_2009
anytime(sep_10_2009)


#----plotting with dates------------------

# Set the x axis to the date column
releases %>%
  ggplot(aes(x = date, y = type)) +
  geom_line(aes(group = 1, color = factor(major)))

# Limit the axis to between 2010-01-01 and 2014-01-01
ggplot(releases, aes(x = date, y = type)) +
  geom_line(aes(group = 1, color = factor(major))) +
  xlim(as.Date("2010-01-01"), as.Date("2014-01-01"))

# Specify breaks every ten years and labels with "%Y"
ggplot(releases, aes(x = date, y = type)) +
  geom_line(aes(group = 1, color = factor(major))) +
  scale_x_date(date_breaks = "10 years", date_labels = "%Y")


#---Arithmetic and logical operators -------------
# Find the largest date
last_release_date <- max(releases$date)

# Filter row for last release
last_release <- filter(releases, date == last_release_date)

# Print last_release
last_release

# How long since last release?
Sys.Date() - last_release_date

```

## 1.2 Times

ISO 8601: HH::MM:SS 

* HH: 00 - 24

* MM: 00 - 59

* SS: 00 -- 60


There are two objects types: 

* **POSIXlt** - list with named components   (*lt* = List Time or local time )

* **POSIXct** - seconds since 1970-01-01 00:00:00  (*ct* = Continuous Time or calendar time)

`as.POSIXct()` - Turns a string into a POSIXct object. 

Timezones: 

* as.POSIXct("2013-02-27T18:00:00Z", tz = "UTC")   # add tz argument to change timezones

Check your tiemzone with: `Sys.timezone()`

```{r}
# Use as.POSIXct to enter the datetime 
as.POSIXct("2010-10-01 12:12:00")

# Use as.POSIXct again but set the timezone to `"America/Los_Angeles"`
as.POSIXct("2010-10-01 12:12:00", tz = "America/Los_Angeles")

# Use read_csv to import rversions.csv
releases <- read_csv("data/rversions.csv")

# Examine structure of datetime column
str(releases$datetime)

# ---------------import and plot --------------
# Import "cran-logs_2015-04-17.csv" with read_csv()
logs <- read_csv("data/cran-logs_2015-04-17.csv")

# Print logs
logs

# Store the release time as a POSIXct object
release_time <- as.POSIXct("2015-04-16 07:13:33", tz = "UTC")

# When is the first download of 3.2.0?
logs %>% 
  filter(datetime > release_time,
    r_version == "3.2.0") %>%
  head(n = 3)

# Examine histograms of downloads by version
ggplot(logs, aes(x = datetime)) +
  geom_histogram() +
  geom_vline(aes(xintercept = as.numeric(release_time)))+
  facet_wrap(~ r_version, ncol = 1)
```

As shown in the figures, it only takes about two days for downloads of the new version(3.2.0) to overtake downloads of the old version (3.1.3). 



# 2. Parsing and Manipulating Dates and Times with lubridate

Objectives: 

* learn how to import dates and times

* learn how to extract parts of datetime 

```{r}
# Parse x 
x <- "2010 September 20th" # 2010-09-20
ymd(x)

# Parse y 
y <- "02.01.2010"  # 2010-01-02
dmy(y)

# Parse z 
z <- "Sep, 12th 2010 14:00"  # 2010-09-12T14:00
mdy_hm(z)


#---parse_date_time()-----------------------
# Specify an order string to parse x
x <- "Monday June 1st 2010 at 4pm"
parse_date_time(x, orders = "amdyIp")

# Specify order to include both "mdy" and "dmy"
two_orders <- c("October 7, 2001", "October 13, 2002", "April 13, 2003", 
  "17 April 2005", "23 April 2017")
parse_date_time(two_orders, orders = c("mdy","dmy"))

# Specify order to include "dOmY", "OmY" and "Y"
short_dates <- c("11 December 1282", "May 1372", "1253")
parse_date_time(short_dates, orders = c("dOmY", "OmY","Y"))


```


# 3. Arithmetic with Dates and Times

Objectives: 

* learn how to calculate with dates and times

```{r}

```



# 4. Problems in Practice 

Objectives: 

* practice real life problems

```{r}

```

